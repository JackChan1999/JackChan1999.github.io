<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="oauth," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="1. 登录1.1 javaweb中如何去维持登录状态 登录后信息放入 session中 页面内验证session中是否有登录信息 如果有，不需要再次登录 如果没有，跳转登录页面 如果登录后点击注销，删除session中登录信息，并清除页面缓存(必要的)  1.2 javaweb中哪些情况我们的session会过期 过期–&amp;gt;很长时间没有去访问网站 主动关闭–&amp;gt;用户注销 切换浏览器">
<meta name="keywords" content="oauth">
<meta property="og:type" content="article">
<meta property="og:title" content="Oauth机制">
<meta property="og:url" content="http://yoursite.com/2017/05/01/android/Oauth机制/index.html">
<meta property="og:site_name" content="秋过冬漫长">
<meta property="og:description" content="1. 登录1.1 javaweb中如何去维持登录状态 登录后信息放入 session中 页面内验证session中是否有登录信息 如果有，不需要再次登录 如果没有，跳转登录页面 如果登录后点击注销，删除session中登录信息，并清除页面缓存(必要的)  1.2 javaweb中哪些情况我们的session会过期 过期–&amp;gt;很长时间没有去访问网站 主动关闭–&amp;gt;用户注销 切换浏览器">
<meta property="og:image" content="http://img.blog.csdn.net/20161112205830243">
<meta property="og:image" content="http://img.blog.csdn.net/20161112210024110">
<meta property="og:image" content="http://img.blog.csdn.net/20161112212056357">
<meta property="og:image" content="http://img.blog.csdn.net/20161112212531631">
<meta property="og:image" content="http://img.blog.csdn.net/20161112213944849">
<meta property="og:image" content="http://img.blog.csdn.net/20161112214934937">
<meta property="og:image" content="http://img.blog.csdn.net/20161112215320861">
<meta property="og:image" content="http://img.blog.csdn.net/20161112220218723">
<meta property="og:image" content="http://bbs.itheima.com/data/attachment/forum/201611/15/144919aczds5674cqdl4ml.png.thumb.jpg">
<meta property="og:image" content="http://img.blog.csdn.net/20161113000257011">
<meta property="og:image" content="http://img.blog.csdn.net/20161113000133774">
<meta property="og:image" content="http://img.blog.csdn.net/20161113114224944">
<meta property="og:image" content="http://img.blog.csdn.net/20161113113626550">
<meta property="og:image" content="http://img.blog.csdn.net/20161113112921498">
<meta property="og:image" content="http://img.blog.csdn.net/20161113112931889">
<meta property="og:image" content="http://img.blog.csdn.net/20161113114515253">
<meta property="og:image" content="http://img.blog.csdn.net/20161113114526039">
<meta property="og:image" content="http://img.blog.csdn.net/20161113115145182">
<meta property="og:image" content="http://img.blog.csdn.net/20161113120821987">
<meta property="og:image" content="http://img.blog.csdn.net/20161120021115253">
<meta property="og:image" content="http://img.blog.csdn.net/20161113010631295">
<meta property="og:image" content="http://img.blog.csdn.net/20161113101753778">
<meta property="og:image" content="http://img.blog.csdn.net/20161112234000759">
<meta property="og:image" content="http://img.blog.csdn.net/20161112153348478">
<meta property="og:image" content="http://img.blog.csdn.net/20161112234430113">
<meta property="og:image" content="http://img.blog.csdn.net/20161112154430044">
<meta property="og:image" content="http://img.blog.csdn.net/20161112181823627">
<meta property="og:image" content="http://img.blog.csdn.net/20161112164809915">
<meta property="og:image" content="http://img.blog.csdn.net/20161112164920996">
<meta property="og:image" content="http://img.blog.csdn.net/20161112165003212">
<meta property="og:image" content="http://img.blog.csdn.net/20161112165110041">
<meta property="og:image" content="http://img.blog.csdn.net/20161112165143839">
<meta property="og:image" content="http://img.blog.csdn.net/20161112155342968">
<meta property="og:image" content="http://img.blog.csdn.net/20161112154835609">
<meta property="og:image" content="http://img.blog.csdn.net/20161112154907806">
<meta property="og:image" content="http://img.blog.csdn.net/20161112154933984">
<meta property="og:updated_time" content="2017-05-01T04:49:25.260Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Oauth机制">
<meta name="twitter:description" content="1. 登录1.1 javaweb中如何去维持登录状态 登录后信息放入 session中 页面内验证session中是否有登录信息 如果有，不需要再次登录 如果没有，跳转登录页面 如果登录后点击注销，删除session中登录信息，并清除页面缓存(必要的)  1.2 javaweb中哪些情况我们的session会过期 过期–&amp;gt;很长时间没有去访问网站 主动关闭–&amp;gt;用户注销 切换浏览器">
<meta name="twitter:image" content="http://img.blog.csdn.net/20161112205830243">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/05/01/android/Oauth机制/"/>





  <title>Oauth机制 | 秋过冬漫长</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">秋过冬漫长</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">没有比脚更长的路，走过去，前面是个天！</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/01/android/Oauth机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JackChan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/ai.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秋过冬漫长">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Oauth机制
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-01T12:37:31+08:00">
                2017-05-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index">
                    <span itemprop="name">android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/05/01/android/Oauth机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/05/01/android/Oauth机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="1-登录"><a href="#1-登录" class="headerlink" title="1. 登录"></a>1. 登录</h1><h2 id="1-1-javaweb中如何去维持登录状态"><a href="#1-1-javaweb中如何去维持登录状态" class="headerlink" title="1.1 javaweb中如何去维持登录状态"></a><strong>1.1 javaweb中如何去维持登录状态</strong></h2><ul>
<li>登录后信息放入 session中</li>
<li>页面内验证session中是否有登录信息</li>
<li>如果有，不需要再次登录</li>
<li>如果没有，跳转登录页面</li>
<li>如果登录后点击注销，删除session中登录信息，并清除页面缓存(必要的)</li>
</ul>
<h2 id="1-2-javaweb中哪些情况我们的session会过期"><a href="#1-2-javaweb中哪些情况我们的session会过期" class="headerlink" title="1.2 javaweb中哪些情况我们的session会过期"></a><strong>1.2 javaweb中哪些情况我们的session会过期</strong></h2><ul>
<li>过期–&gt;很长时间没有去访问网站</li>
<li>主动关闭–&gt;用户注销</li>
<li>切换浏览器</li>
</ul>
<a id="more"></a>
<h2 id="1-3-手机端如何维持登录状态"><a href="#1-3-手机端如何维持登录状态" class="headerlink" title="1.3 手机端如何维持登录状态"></a><strong>1.3 手机端如何维持登录状态</strong></h2><p>通过sessionKey/tokenKey</p>
<p>登录协议</p>
<p><img src="http://img.blog.csdn.net/20161112205830243" alt="登录协议"></p>
<p><img src="http://img.blog.csdn.net/20161112210024110" alt="这里写图片描述"></p>
<p>###<strong>1.3.1 sessionKey/tokenKey哪里来?</strong><br>登录成功之后,后台返回</p>
<p>###<strong>1.3.2 sessionKey/tokenKey生成有什么规则?</strong><br>后台返回的，按照一定规则生成的(比如可以随机数生成一个24位以上的字符串)</p>
<p>###<strong>1.3.3 登录成功返回的sessionkey/tokenKey存到哪里?</strong><br>保存到sp中就可以了</p>
<p>###<strong>1.3.4 sessionkey/tokenKey使用场景</strong><br>有些协议需要用到登录信息，就需要看登录状态，就需要用到sessionkey/tokenKey，比如支付协议</p>
<p><img src="http://img.blog.csdn.net/20161112212056357" alt="这里写图片描述"></p>
<p>###<strong>1.3.5 如何使用sessionkey/tokenKey?</strong><br>需要登录状态，判断sp中是否有sessionkey/tokenKey?</p>
<ul>
<li>有：那当前是已登录状态，就把个人信息和sessionkey/tokenKey上传到服务器;</li>
<li>没有：跳到登录界面，让用户登录</li>
</ul>
<p>###<strong>1.3.6 谁去判断sessionkey/tokenKey是否过期?</strong><br>任何协议把sessionkey/tokenKey传到服务器.服务器会判断sessionkey/tokenKey是否过期?</p>
<ul>
<li>过期：告知客户端，登录状态已过期，需要重新登录</li>
<li><p>未过期：可以使用当前的登录信息，继续走逻辑<br>###<strong>1.3.7 为什么判断是否过期需要后台做?</strong><br>因为前端可以修改当前时间?<br>###<strong>1.3.8 sessionkey/tokenKey多久过期?</strong><br>这个具体看公司<br>###<strong>1.3.9 后台如何去判断sessionkey/tokenKey是否过期？</strong><br><img src="http://img.blog.csdn.net/20161112212531631" alt="这里写图片描述"></p>
</li>
<li><p>分配sessionkey/tokenKey的时候记录时间</p>
</li>
<li>判断是否存在对应的sessionKey：如果不存在，是不是直接就是无效.</li>
<li>某一时刻，用户判断sessionkey/tokenKey是否过期的时候，拿着当前时间和sessionkey/tokenKey分配时间做比较</li>
<li>大于指定时间：过期</li>
<li>没有大于指定时间：未过期</li>
</ul>
<p>##2. logindemo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> Button	mLogin;</div><div class="line">	<span class="keyword">private</span> SPUtil	mSpUtil;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">		setContentView(R.layout.activity_main);</div><div class="line">		mLogin = (Button) findViewById(R.id.login);</div><div class="line">		mSpUtil = <span class="keyword">new</span> SPUtil(MainActivity.<span class="keyword">this</span>);</div><div class="line">		mLogin.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">				<span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</div><div class="line"></div><div class="line">					<span class="meta">@Override</span></div><div class="line">					<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">						<span class="comment">// TODO</span></div><div class="line">						<span class="keyword">try</span> &#123;</div><div class="line">							DefaultHttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient();</div><div class="line">							HttpGet get = <span class="keyword">new</span> HttpGet(</div><div class="line">									<span class="string">"http://mobileif.maizuo.com/user/login?"</span></div><div class="line">									+ <span class="string">"username=18682036558&amp;"</span></div><div class="line">									+ <span class="string">"password=96e79218965eb72c92a549dd5a330112&amp;"</span></div><div class="line">									+ <span class="string">"type=1&amp;"</span></div><div class="line">									+ <span class="string">"userType=1&amp;"</span></div><div class="line">									+ <span class="string">"appType=31&amp;"</span></div><div class="line">									+ <span class="string">"agentID=0-maizuo&amp;"</span></div><div class="line">									+ <span class="string">"loginType=1&amp;"</span></div><div class="line">									+ <span class="string">"clientID=31&amp;"</span></div><div class="line">									+ <span class="string">"channelID=31"</span>);</div><div class="line">							HttpResponse response = httpClient.execute(get);</div><div class="line"></div><div class="line">							<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</div><div class="line">								HttpEntity entity = response.getEntity();</div><div class="line">								String result = EntityUtils.toString(entity);</div><div class="line">								System.out.println(<span class="string">"result :"</span> + result);</div><div class="line">								<span class="comment">// 得到sessionKey保存到sp中</span></div><div class="line">								JSONObject jsonObject = <span class="keyword">new</span> JSONObject(result);</div><div class="line">								String sessionKey = jsonObject.optString(<span class="string">"sessionKey"</span>);</div><div class="line"></div><div class="line">								<span class="comment">// 保存到sp中</span></div><div class="line">								mSpUtil.putString(<span class="string">"sessionKey"</span>, sessionKey);</div><div class="line">							&#125;</div><div class="line">						&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">							e.printStackTrace();</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">				&#125;).start();</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		findViewById(R.id.pay).setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line"></div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">				<span class="comment">// 这个地方需要使用sessionKey,对应的一般操作,首先判断是否存在</span></div><div class="line">				String spSessionKey = mSpUtil.getString(<span class="string">"sessionKey"</span>, <span class="string">""</span>);</div><div class="line">				<span class="keyword">if</span> (<span class="string">""</span>.equals(spSessionKey)) &#123;</div><div class="line">					Toast.makeText(getApplicationContext(), <span class="string">"请先登录"</span>, <span class="number">0</span>).show();</div><div class="line">					<span class="keyword">return</span> ;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">//接着就是把对应的sessionKey和userid和payinfo上传给服务器</span></div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>返回数据</p>
<p><img src="http://img.blog.csdn.net/20161112213944849" alt="sessionkey"></p>
<p>##3. 绘流程图说明sessionKey的使用<br>以确认支付协议为例</p>
<p>##验证码登录/注册_简单流程<br>1、提交手机号 2、下发短信验证码 3、提交验证码</p>
<p><img src="http://img.blog.csdn.net/20161112214934937" alt="验证码登录"></p>
<p>验证码后台过期逻辑</p>
<p><img src="http://img.blog.csdn.net/20161112215320861" alt="这里写图片描述"></p>
<p>##验证码登录/注册_流程描述</p>
<ul>
<li>用户填写手机号，点击发送验证码，发送请求把手机号传到server</li>
<li>server调用短信平台的接口知道发送内容，发送对象，完成短信的发送</li>
<li>用户收到短信，得到验证码，填写验证码，发送请求把手机号，验证码上传到server</li>
<li>server判断我们的验证码是否正确，验证是否过期，根据不同的判断，返回不同的结果</li>
</ul>
<p>##share sdk 短信验证码理解</p>
<p><img src="http://img.blog.csdn.net/20161112220218723" alt="这里写图片描述"></p>
<p>#Android登录注册模块解决方案<br>原文链接：<a href="http://blog.csdn.net/wwj_748/article/details/50575642" target="_blank" rel="external">http://blog.csdn.net/wwj_748/article/details/50575642</a></p>
<p>几乎每个app都会有登录注册的功能，可以看看笔者开发的『南方周末新闻阅读器』，登录、手机注册、忘记密码这些入口，这些功能在app中要如何来实现呢？这个模块看似很简单，但要做好就需要考虑很多细节，比如对用户的输入的容错，操作的提示文案的设定，登录成功保存用户信息等等。</p>
<p><img src="http://bbs.itheima.com/data/attachment/forum/201611/15/144919aczds5674cqdl4ml.png.thumb.jpg" alt="登录注册"></p>
<p>业务逻辑描述上一节的流程图已经很清晰的展现了登录注册的流程，这里继续用文字说明一下：</p>
<ol>
<li>点击进入个人中心或者需要用户登录状态的操作，先判断用户是否已经登录。</li>
<li>如果已经登录，则继续后面的业务，否则，跳转到登录页面进行登录。</li>
<li>如果已经有账号，则可以直接登录，或者可以直接选择第三方平台授权登录。</li>
<li>如果未注册账号，则需要先进行账号注册，注册成功后再登录；也可以不注册账号，通过第三方平台授权进行登录。</li>
<li>如果有账号，但忘记密码，则需要进行重置密码，否则直接登录。</li>
</ol>
<p>具体实现登录可以使用账号登录，现在的app基本上都是手机号码登录，注册的时候也是一个手机对应一个账号，通过发送验证码进行验证；用户也可以选择第三方平台进行登录，一般会提供微信、QQ、新浪微博这样的主流社交平台进行授权登录，这里使用了友盟的SDK进行实现。</p>
<p>登录注册的解决方案，已经做成一个Demo，大家在实际开发的时候可以参考着根据自身的业务进行调整，但基本上不会差太多，第三方登录、验证码这个都可以选用第三方服务来实现</p>
<p>示例代码：LoginActivity.Java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.devilwwj.loginandregister;  </div><div class="line">   </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.text.TextUtils;  </div><div class="line"><span class="keyword">import</span> android.text.method.HideReturnsTransformationMethod;  </div><div class="line"><span class="keyword">import</span> android.text.method.PasswordTransformationMethod;  </div><div class="line"><span class="keyword">import</span> android.view.KeyEvent;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.view.inputmethod.EditorInfo;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line"><span class="keyword">import</span> android.widget.Toast;  </div><div class="line">   </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.global.AppConstants;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.LogUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.ProgressDialogUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.RegexUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.ShareUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.SpUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.ToastUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.Utils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.views.CleanEditText;  </div><div class="line"><span class="keyword">import</span> com.umeng.socialize.bean.SHARE_MEDIA;  </div><div class="line"><span class="keyword">import</span> com.umeng.socialize.controller.UMServiceFactory;  </div><div class="line"><span class="keyword">import</span> com.umeng.socialize.controller.UMSocialService;  </div><div class="line"><span class="keyword">import</span> com.umeng.socialize.controller.listener.SocializeListeners.UMAuthListener;  </div><div class="line"><span class="keyword">import</span> com.umeng.socialize.controller.listener.SocializeListeners.UMDataListener;  </div><div class="line"><span class="keyword">import</span> com.umeng.socialize.exception.SocializeException;  </div><div class="line">   </div><div class="line"><span class="keyword">import</span> java.util.Map;  </div><div class="line">   </div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.view.View.OnClickListener;  </div><div class="line">   </div><div class="line"><span class="comment">/** </span></div><div class="line"> * <span class="doctag">@desc</span> 登录界面 </div><div class="line"> * Created by devilwwj on 16/1/24. </div><div class="line"> */ </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span> </span>&#123;  </div><div class="line">   </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"loginActivity"</span>;  </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_CODE_TO_REGISTER = <span class="number">0x001</span>;  </div><div class="line">   </div><div class="line">    <span class="comment">// 界面控件  </span></div><div class="line">    <span class="keyword">private</span> CleanEditText accountEdit;  </div><div class="line">    <span class="keyword">private</span> CleanEditText passwordEdit;  </div><div class="line">   </div><div class="line">    <span class="comment">// 第三方平台获取的访问token，有效时间，uid  </span></div><div class="line">    <span class="keyword">private</span> String accessToken;  </div><div class="line">    <span class="keyword">private</span> String expires_in;  </div><div class="line">    <span class="keyword">private</span> String uid;  </div><div class="line">    <span class="keyword">private</span> String sns;  </div><div class="line">   </div><div class="line">    <span class="comment">// 整个平台的Controller，负责管理整个SDK的配置、操作等处理  </span></div><div class="line">    <span class="keyword">private</span> UMSocialService mController = UMServiceFactory  </div><div class="line">            .getUMSocialService(AppConstants.DESCRIPTOR);  </div><div class="line">   </div><div class="line">   </div><div class="line">    <span class="meta">@Override</span> </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_login);  </div><div class="line">   </div><div class="line">        initViews();  </div><div class="line">   </div><div class="line">        <span class="comment">// 配置分享平台  </span></div><div class="line">        ShareUtils.configPlatforms(<span class="keyword">this</span>);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 初始化视图 </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initViews</span><span class="params">()</span> </span>&#123;  </div><div class="line">        accountEdit = (CleanEditText) <span class="keyword">this</span>.findViewById(R.id.et_email_phone);  </div><div class="line">        accountEdit.setImeOptions(EditorInfo.IME_ACTION_NEXT);  </div><div class="line">        accountEdit.setTransformationMethod(HideReturnsTransformationMethod  </div><div class="line">                .getInstance());  </div><div class="line">        passwordEdit = (CleanEditText) <span class="keyword">this</span>.findViewById(R.id.et_password);  </div><div class="line">        passwordEdit.setImeOptions(EditorInfo.IME_ACTION_DONE);  </div><div class="line">        passwordEdit.setImeOptions(EditorInfo.IME_ACTION_GO);  </div><div class="line">        passwordEdit.setTransformationMethod(PasswordTransformationMethod  </div><div class="line">                .getInstance());  </div><div class="line">        passwordEdit.setOnEditorActionListener(<span class="keyword">new</span> TextView.OnEditorActionListener() &#123;  </div><div class="line">   </div><div class="line">            <span class="meta">@Override</span> </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onEditorAction</span><span class="params">(TextView v, <span class="keyword">int</span> actionId,  </span></span></div><div class="line">                                          KeyEvent event) &#123;  </div><div class="line">                <span class="keyword">if</span> (actionId == EditorInfo.IME_ACTION_DONE  </div><div class="line">                        || actionId == EditorInfo.IME_ACTION_GO) &#123;  </div><div class="line">                    clickLogin();  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clickLogin</span><span class="params">()</span> </span>&#123;  </div><div class="line">        String account = accountEdit.getText().toString();  </div><div class="line">        String password = passwordEdit.getText().toString();  </div><div class="line">        <span class="keyword">if</span> (checkInput(account, password)) &#123;  </div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> 请求服务器登录账号  </span></div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 检查输入 </div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> account </div><div class="line">     * <span class="doctag">@param</span> password </div><div class="line">     * <span class="doctag">@return</span> </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkInput</span><span class="params">(String account, String password)</span> </span>&#123;  </div><div class="line">        <span class="comment">// 账号为空时提示  </span></div><div class="line">        <span class="keyword">if</span> (account == <span class="keyword">null</span> || account.trim().equals(<span class="string">""</span>)) &#123;  </div><div class="line">            Toast.makeText(<span class="keyword">this</span>, R.string.tip_account_empty, Toast.LENGTH_LONG)  </div><div class="line">                    .show();  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="comment">// 账号不匹配手机号格式（11位数字且以1开头）  </span></div><div class="line">            <span class="keyword">if</span> ( !RegexUtils.checkMobile(account)) &#123;  </div><div class="line">                Toast.makeText(<span class="keyword">this</span>, R.string.tip_account_regex_not_right,  </div><div class="line">                        Toast.LENGTH_LONG).show();  </div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (password == <span class="keyword">null</span> || password.trim().equals(<span class="string">""</span>)) &#123;  </div><div class="line">                Toast.makeText(<span class="keyword">this</span>, R.string.tip_password_can_not_be_empty,  </div><div class="line">                        Toast.LENGTH_LONG).show();  </div><div class="line">            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">   </div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="meta">@Override</span> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">        Intent intent = <span class="keyword">null</span>;  </div><div class="line">        <span class="keyword">switch</span> (v.getId()) &#123;  </div><div class="line">            <span class="keyword">case</span> R.id.iv_cancel:  </div><div class="line">                finish();  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> R.id.btn_login:  </div><div class="line">                clickLogin();  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> R.id.iv_wechat:  </div><div class="line">                clickLoginWexin();  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> R.id.iv_qq:  </div><div class="line">                clickLoginQQ();  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> R.id.iv_sina:  </div><div class="line">                loginThirdPlatform(SHARE_MEDIA.SINA);  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> R.id.tv_create_account:  </div><div class="line">                enterRegister();  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> R.id.tv_forget_password:  </div><div class="line">                enterForgetPwd();  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">default</span>:  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 点击使用QQ快速登录 </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clickLoginQQ</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (!Utils.isQQClientAvailable(<span class="keyword">this</span>)) &#123;  </div><div class="line">            ToastUtils.showShort(LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                    getString(R.string.no_install_qq));  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            loginThirdPlatform(SHARE_MEDIA.QZONE);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 点击使用微信登录 </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">clickLoginWexin</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (!Utils.isWeixinAvilible(<span class="keyword">this</span>)) &#123;  </div><div class="line">            ToastUtils.showShort(LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                    getString(R.string.no_install_wechat));  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            loginThirdPlatform(SHARE_MEDIA.WEIXIN);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 跳转到忘记密码 </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">enterForgetPwd</span><span class="params">()</span> </span>&#123;  </div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ForgetPasswordActivity.class);  </div><div class="line">        startActivity(intent);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 跳转到注册页面 </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">enterRegister</span><span class="params">()</span> </span>&#123;  </div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, SignUpActivity.class);  </div><div class="line">        startActivityForResult(intent, REQUEST_CODE_TO_REGISTER);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 授权。如果授权成功，则获取用户信息 </div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> platform </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loginThirdPlatform</span><span class="params">(<span class="keyword">final</span> SHARE_MEDIA platform)</span> </span>&#123;  </div><div class="line">        mController.doOauthVerify(LoginActivity.<span class="keyword">this</span>, platform,  </div><div class="line">                <span class="keyword">new</span> UMAuthListener() &#123;  </div><div class="line">   </div><div class="line">                    <span class="meta">@Override</span> </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(SHARE_MEDIA platform)</span> </span>&#123;  </div><div class="line">                        LogUtils.i(TAG, <span class="string">"onStart------"</span> </div><div class="line">                                + Thread.currentThread().getId());  </div><div class="line">                        ProgressDialogUtils.getInstance().show(  </div><div class="line">                                LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                                getString(R.string.tip_begin_oauth));  </div><div class="line">                    &#125;  </div><div class="line">   </div><div class="line">                    <span class="meta">@Override</span> </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(SocializeException e,  </span></span></div><div class="line">                                        SHARE_MEDIA platform) &#123;  </div><div class="line">                        LogUtils.i(TAG, <span class="string">"onError------"</span> </div><div class="line">                                + Thread.currentThread().getId());  </div><div class="line">                        ToastUtils.showShort(LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                                getString(R.string.oauth_fail));  </div><div class="line">                        ProgressDialogUtils.getInstance().dismiss();  </div><div class="line">                    &#125;  </div><div class="line">   </div><div class="line">                    <span class="meta">@Override</span> </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(Bundle value, SHARE_MEDIA platform)</span> </span>&#123;  </div><div class="line">                        LogUtils.i(TAG, <span class="string">"onComplete------"</span> + value.toString());  </div><div class="line">                        <span class="keyword">if</span> (platform == SHARE_MEDIA.SINA) &#123;  </div><div class="line">                            accessToken = value.getString(<span class="string">"access_key"</span>);  </div><div class="line">                        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                            accessToken = value.getString(<span class="string">"access_token"</span>);  </div><div class="line">                        &#125;  </div><div class="line">                        expires_in = value.getString(<span class="string">"expires_in"</span>);  </div><div class="line">                        <span class="comment">// 获取uid  </span></div><div class="line">                        uid = value.getString(AppConstants.UID);  </div><div class="line">                        <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; !TextUtils.isEmpty(uid)) &#123;  </div><div class="line">                            <span class="comment">// uid不为空，获取用户信息  </span></div><div class="line">                            getUserInfo(platform);  </div><div class="line">                        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                            ToastUtils.showShort(LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                                    getString(R.string.oauth_fail));  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">   </div><div class="line">                    <span class="meta">@Override</span> </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancel</span><span class="params">(SHARE_MEDIA platform)</span> </span>&#123;  </div><div class="line">                        LogUtils.i(TAG, <span class="string">"onCancel------"</span> </div><div class="line">                                + Thread.currentThread().getId());  </div><div class="line">                        ToastUtils.showShort(LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                                getString(R.string.oauth_cancle));  </div><div class="line">                        ProgressDialogUtils.getInstance().dismiss();  </div><div class="line">   </div><div class="line">                    &#125;  </div><div class="line">                &#125;);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 获取用户信息 </div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> platform </div><div class="line">     */ </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getUserInfo</span><span class="params">(<span class="keyword">final</span> SHARE_MEDIA platform)</span> </span>&#123;  </div><div class="line">        mController.getPlatformInfo(LoginActivity.<span class="keyword">this</span>, platform,  </div><div class="line">                <span class="keyword">new</span> UMDataListener() &#123;  </div><div class="line">   </div><div class="line">                    <span class="meta">@Override</span> </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;  </div><div class="line">                        <span class="comment">// 开始获取  </span></div><div class="line">                        LogUtils.i(<span class="string">"getUserInfo"</span>, <span class="string">"onStart------"</span>);  </div><div class="line">                        ProgressDialogUtils.getInstance().dismiss();  </div><div class="line">                        ProgressDialogUtils.getInstance().show(  </div><div class="line">                                LoginActivity.<span class="keyword">this</span>, <span class="string">"正在请求..."</span>);  </div><div class="line">                    &#125;  </div><div class="line">   </div><div class="line">                    <span class="meta">@Override</span> </div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(<span class="keyword">int</span> status, Map info)</span> </span>&#123;  </div><div class="line">   </div><div class="line">                        <span class="keyword">try</span> &#123;  </div><div class="line">                            String sns_id = <span class="string">""</span>;  </div><div class="line">                            String sns_avatar = <span class="string">""</span>;  </div><div class="line">                            String sns_loginname = <span class="string">""</span>;  </div><div class="line">                            <span class="keyword">if</span> (info != <span class="keyword">null</span> &amp;&amp; info.size() != <span class="number">0</span>) &#123;  </div><div class="line">                                LogUtils.i(<span class="string">"third login"</span>, info.toString());  </div><div class="line">   </div><div class="line">                                <span class="keyword">if</span> (platform == SHARE_MEDIA.SINA) &#123; <span class="comment">// 新浪微博  </span></div><div class="line">                                    sns = AppConstants.SINA;  </div><div class="line">                                    <span class="keyword">if</span> (info.get(AppConstants.UID) != <span class="keyword">null</span>) &#123;  </div><div class="line">                                        sns_id = info.get(AppConstants.UID)  </div><div class="line">                                                .toString();  </div><div class="line">                                    &#125;  </div><div class="line">                                    <span class="keyword">if</span> (info.get(AppConstants.PROFILE_IMAGE_URL) != <span class="keyword">null</span>) &#123;  </div><div class="line">                                        sns_avatar = info  </div><div class="line">                                                .get(AppConstants.PROFILE_IMAGE_URL)  </div><div class="line">                                                .toString();  </div><div class="line">                                    &#125;  </div><div class="line">                                    <span class="keyword">if</span> (info.get(AppConstants.SCREEN_NAME) != <span class="keyword">null</span>) &#123;  </div><div class="line">                                        sns_loginname = info.get(  </div><div class="line">                                                AppConstants.SCREEN_NAME)  </div><div class="line">                                                .toString();  </div><div class="line">                                    &#125;  </div><div class="line">                                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (platform == SHARE_MEDIA.QZONE) &#123; <span class="comment">// QQ  </span></div><div class="line">                                    sns = AppConstants.QQ;  </div><div class="line">                                    <span class="keyword">if</span> (info.get(AppConstants.UID) == <span class="keyword">null</span>) &#123;  </div><div class="line">                                        ToastUtils  </div><div class="line">                                                .showShort(  </div><div class="line">                                                        LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                                                        getString(R.string.oauth_fail));  </div><div class="line">                                        <span class="keyword">return</span>;  </div><div class="line">                                    &#125;  </div><div class="line">                                    sns_id = info.get(AppConstants.UID)  </div><div class="line">                                            .toString();  </div><div class="line">                                    sns_avatar = info.get(  </div><div class="line">                                            AppConstants.PROFILE_IMAGE_URL)  </div><div class="line">                                            .toString();  </div><div class="line">                                    sns_loginname = info.get(  </div><div class="line">                                            AppConstants.SCREEN_NAME)  </div><div class="line">                                            .toString();  </div><div class="line">                                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (platform == SHARE_MEDIA.WEIXIN) &#123; <span class="comment">// 微信  </span></div><div class="line">                                    sns = AppConstants.WECHAT;  </div><div class="line">                                    sns_id = info.get(AppConstants.OPENID)  </div><div class="line">                                            .toString();  </div><div class="line">                                    sns_avatar = info.get(  </div><div class="line">                                            AppConstants.HEADIMG_URL)  </div><div class="line">                                            .toString();  </div><div class="line">                                    sns_loginname = info.get(  </div><div class="line">                                            AppConstants.NICKNAME).toString();  </div><div class="line">                                &#125;  </div><div class="line">   </div><div class="line">                                <span class="comment">// 这里直接保存第三方返回来的用户信息  </span></div><div class="line">                                SpUtils.putBoolean(LoginActivity.<span class="keyword">this</span>,  </div><div class="line">                                        AppConstants.THIRD_LOGIN, <span class="keyword">true</span>);  </div><div class="line">   </div><div class="line">                                LogUtils.e(<span class="string">"info"</span>, sns + <span class="string">","</span> + sns_id + <span class="string">","</span> </div><div class="line">                                        + sns_loginname);  </div><div class="line">   </div><div class="line">                                <span class="comment">// <span class="doctag">TODO:</span> 这里执行第三方连接(绑定服务器账号）  </span></div><div class="line">   </div><div class="line">   </div><div class="line">                            &#125;  </div><div class="line">                        &#125; <span class="keyword">catch</span> (Exception e) &#123;  </div><div class="line">                            e.printStackTrace();  </div><div class="line">                        &#125;  </div><div class="line">                    &#125;  </div><div class="line">   </div><div class="line">                &#125;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例代码：SignUpActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.devilwwj.loginandregister;  </div><div class="line">   </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.text.TextUtils;  </div><div class="line"><span class="keyword">import</span> android.util.Log;  </div><div class="line"><span class="keyword">import</span> android.view.KeyEvent;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.view.View.OnClickListener;  </div><div class="line"><span class="keyword">import</span> android.view.inputmethod.EditorInfo;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView.OnEditorActionListener;  </div><div class="line">   </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.RegexUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.ToastUtils;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.utils.VerifyCodeManager;  </div><div class="line"><span class="keyword">import</span> com.devilwwj.loginandregister.views.CleanEditText;  </div><div class="line">   </div><div class="line"><span class="comment">/** </span></div><div class="line"> * <span class="doctag">@desc</span> 注册界面 </div><div class="line"> * 功能描述：一般会使用手机登录，通过获取手机验证码，跟服务器交互完成注册 </div><div class="line"> * Created by devilwwj on 16/1/24. </div><div class="line"> */ </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SignUpActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">OnClickListener</span></span>&#123;  </div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SignupActivity"</span>;  </div><div class="line">    <span class="comment">// 界面控件  </span></div><div class="line">    <span class="keyword">private</span> CleanEditText phoneEdit;  </div><div class="line">    <span class="keyword">private</span> CleanEditText passwordEdit;  </div><div class="line">    <span class="keyword">private</span> CleanEditText verifyCodeEdit;  </div><div class="line">    <span class="keyword">private</span> Button getVerifiCodeButton;  </div><div class="line">   </div><div class="line">    <span class="keyword">private</span> VerifyCodeManager codeManager;  </div><div class="line">   </div><div class="line">    <span class="meta">@Override</span> </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_signup);  </div><div class="line">   </div><div class="line">        initViews();  </div><div class="line">        codeManager = <span class="keyword">new</span> VerifyCodeManager(<span class="keyword">this</span>, phoneEdit, getVerifiCodeButton);  </div><div class="line">   </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="comment">/** </span></div><div class="line">     * 通用findViewById,减少重复的类型转换 </div><div class="line">     * </div><div class="line">     * <span class="doctag">@param</span> id </div><div class="line">     * <span class="doctag">@return</span> </div><div class="line">     */ </div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span>  E <span class="title">getView</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;  </div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            <span class="keyword">return</span> (E) findViewById(id);  </div><div class="line">        &#125; <span class="keyword">catch</span> (ClassCastException ex) &#123;  </div><div class="line">            Log.e(TAG, <span class="string">"Could not cast View to concrete class."</span>, ex);  </div><div class="line">            <span class="keyword">throw</span> ex;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initViews</span><span class="params">()</span> </span>&#123;  </div><div class="line">   </div><div class="line">        getVerifiCodeButton = getView(R.id.btn_send_verifi_code);  </div><div class="line">        getVerifiCodeButton.setOnClickListener(<span class="keyword">this</span>);  </div><div class="line">        phoneEdit = getView(R.id.et_phone);  </div><div class="line">        phoneEdit.setImeOptions(EditorInfo.IME_ACTION_NEXT);<span class="comment">// 下一步  </span></div><div class="line">        verifyCodeEdit = getView(R.id.et_verifiCode);  </div><div class="line">        verifyCodeEdit.setImeOptions(EditorInfo.IME_ACTION_NEXT);<span class="comment">// 下一步  </span></div><div class="line">        passwordEdit = getView(R.id.et_password);  </div><div class="line">        passwordEdit.setImeOptions(EditorInfo.IME_ACTION_DONE);  </div><div class="line">        passwordEdit.setImeOptions(EditorInfo.IME_ACTION_GO);  </div><div class="line">        passwordEdit.setOnEditorActionListener(<span class="keyword">new</span> OnEditorActionListener() &#123;  </div><div class="line">   </div><div class="line">            <span class="meta">@Override</span> </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onEditorAction</span><span class="params">(TextView v, <span class="keyword">int</span> actionId,  </span></span></div><div class="line">                                          KeyEvent event) &#123;  </div><div class="line">                <span class="comment">// 点击虚拟键盘的done  </span></div><div class="line">                <span class="keyword">if</span> (actionId == EditorInfo.IME_ACTION_DONE  </div><div class="line">                        || actionId == EditorInfo.IME_ACTION_GO) &#123;  </div><div class="line">                    commit();  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">()</span> </span>&#123;  </div><div class="line">        String phone = phoneEdit.getText().toString().trim();  </div><div class="line">        String password = passwordEdit.getText().toString().trim();  </div><div class="line">        String code = verifyCodeEdit.getText().toString().trim();  </div><div class="line">   </div><div class="line">        <span class="keyword">if</span> (checkInput(phone, password, code)) &#123;  </div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span>请求服务端注册账号  </span></div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">checkInput</span><span class="params">(String phone, String password, String code)</span> </span>&#123;  </div><div class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(phone)) &#123; <span class="comment">// 电话号码为空  </span></div><div class="line">            ToastUtils.showShort(<span class="keyword">this</span>, R.string.tip_phone_can_not_be_empty);  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="keyword">if</span> (!RegexUtils.checkMobile(phone)) &#123; <span class="comment">// 电话号码格式有误  </span></div><div class="line">                ToastUtils.showShort(<span class="keyword">this</span>, R.string.tip_phone_regex_not_right);  </div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (TextUtils.isEmpty(code)) &#123; <span class="comment">// 验证码不正确  </span></div><div class="line">                ToastUtils.showShort(<span class="keyword">this</span>, R.string.tip_please_input_code);  </div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (password.length() &lt; <span class="number">6</span> || password.length() &gt; <span class="number">32</span> </div><div class="line">                    || TextUtils.isEmpty(password)) &#123; <span class="comment">// 密码格式  </span></div><div class="line">                ToastUtils.showShort(<span class="keyword">this</span>,  </div><div class="line">                        R.string.tip_please_input_6_32_password);  </div><div class="line">            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">   </div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">    &#125;  </div><div class="line">   </div><div class="line">    <span class="meta">@Override</span> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">        <span class="keyword">switch</span> (v.getId()) &#123;  </div><div class="line">            <span class="keyword">case</span> R.id.btn_send_verifi_code:  </div><div class="line">                <span class="comment">// TODO 请求接口发送验证码  </span></div><div class="line">                codeManager.getVerifyCode(VerifyCodeManager.REGISTER);  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">   </div><div class="line">            <span class="keyword">default</span>:  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#QQ登录</p>
<p>网址：<a href="http://wiki.connect.qq.com/sdk%E4%B8%8B%E8%BD%BD" target="_blank" rel="external">http://wiki.connect.qq.com/sdk%E4%B8%8B%E8%BD%BD</a><br>集成步骤(移动应用接入流程)</p>
<p>1.注册成为开发者，登录<br>2.点击申请加入，创建应用–&gt;会分配appId，appKey</p>
<ul>
<li>APP ID：1104072093</li>
<li>APP KEY：PzMWIM4GYZvxGRjd</li>
</ul>
<p>3.完善信息<br>4.下载demo.运行看效果<br>5.集成开发</p>
<ul>
<li>webview方式(老方式)：授权的时候是跳到了一个webview上去授权</li>
<li>sso方式：如果手机里面装了qq.那就是单点登录的形式.如果没有装qq，就是跳到webview这种老方式;</li>
<li>sso：单点登录</li>
</ul>
<p>集成步骤_官方</p>
<p>1.注册成为开发者<br>2.创建应用<br>3.完善应用信息<br>4.提交上线申请<br>5.通过审核上线</p>
<p><img src="http://img.blog.csdn.net/20161113000257011" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20161113000133774" alt="这里写图片描述"></p>
<p>通过广播的方式拿到access_token</p>
<p>#新浪微博<br><img src="http://img.blog.csdn.net/20161113114224944" alt="oauth"></p>
<p>1、点击了发起授权请求的按钮，使用WebView加载登陆网页，也是oauth2.0授权步骤中的第一步，其实就是去打开了一个授权的网页</p>
<p>通过Get方式传递三个参数: client_id(应用的appkey)，redirect_uri(回调地址)，display(展示方式，手机设备为mobile)</p>
<p><a href="https://auth.sina.com.cn/oauth2/authorize?client_id=3237555059&amp;redirect_uri=http%3A%2F%2Fbilly.itheima.com&amp;display=mobile" target="_blank" rel="external">https://auth.sina.com.cn/oauth2/authorize?client_id=3237555059&amp;redirect_uri=http%3A%2F%2Fbilly.itheima.com&amp;display=mobile</a></p>
<p>2、用户授权完成之后，回调到回调页，同时传递code(授权码)</p>
<p>在wap页点击登陆按钮后, 会有一个回调地址, 可以在WebViewClient的shouldOverrideUrlLoading方法中捕获。</p>
<p>用户点击登录后, 是一个302跳转, 跳转地址就是申请appkey时填写的Redirect URL, 登录成功后这个地址后面带有code参数. 如果是移动端的话, 这个地址不需要有实体的页面</p>
<p>回调页：<a href="http://billy.itheima.com/?code=ce97366666b1b902575ce207401477ff&amp;state=" target="_blank" rel="external">http://billy.itheima.com/?code=ce97366666b1b902575ce207401477ff&amp;state=</a></p>
<p>3、拿着授权的code请求access_token</p>
<p>请求地址:<a href="https://auth.sina.com.cn/oauth2/access_token" target="_blank" rel="external">https://auth.sina.com.cn/oauth2/access_token</a><br>请求方式:post<br>请求参数的形式:key-value<br>请求具体参数<br>client_id=3237555059&amp;client_secret=2b6c964b071e2ecc28c1835628cc6901&amp;grant_type=authorization_code&amp;code=ce97366666b1b902575ce207401477ff&amp;redirect_uri=http%3A%2F%2Fbilly.itheima.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">       &quot;access_token&quot;: &quot;26883566623yk3e3x6rXZ3gOj5J35b6d&quot;,</div><div class="line">       &quot;expires_in&quot;: 1437982314,</div><div class="line">       &quot;time_left&quot;: 22868,</div><div class="line">       &quot;uid&quot;: &quot;1884774904&quot;,</div><div class="line">       &quot;refresh_token&quot;: &quot;f244f166623yk3e3x6rXZ3gOj5Jf1bb7&quot;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>获取用户信息</p>
<p><a href="https://api.weipan.cn/2/account/info?access_token=26883566623yk3e3x6rXZ3gOj5J35b6d" target="_blank" rel="external">https://api.weipan.cn/2/account/info?access_token=26883566623yk3e3x6rXZ3gOj5J35b6d</a></p>
<p><img src="http://img.blog.csdn.net/20161113113626550" alt="oauth"></p>
<p><img src="http://img.blog.csdn.net/20161113112921498" alt="oauth"></p>
<p><img src="http://img.blog.csdn.net/20161113112931889" alt="oauth"></p>
<p>##<strong>access_token加密</strong><br>access_token的保存，有关加密算法的相关知识，<a href="http://blog.csdn.net/axi295309066/article/details/52491077" target="_blank" rel="external">请看Android安全加密系列文章</a></p>
<p><img src="http://img.blog.csdn.net/20161113114515253" alt="token保存"></p>
<p><img src="http://img.blog.csdn.net/20161113114526039" alt="token保存"></p>
<p>密码规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">this.PASSWORD = &quot;com.sina.vdisk.security.password.d7af3082d815945ff47ae58647bd9436&quot;</div><div class="line">                + IMEI + appKeyPair.key + appKeyPair.secret;</div></pre></td></tr></table></figure>
<p><img src="http://img.blog.csdn.net/20161113115145182" alt="密码规则"></p>
<p>##<strong>IMEI</strong><br>有别于sim卡的序列号，可以作为手机的唯一标识，类似我们pc的机器码</p>
<p>两个概念</p>
<ul>
<li>imei：设备的唯一标识</li>
<li>imsi：移动sim卡的唯一标识</li>
</ul>
<p>买手机：3码合一 手机序列号 电池序列号 手机包装序列号</p>
<p>统计apk的安装量：启动应用程序的时候，把手机的imei号上传到服务器</p>
<p><img src="http://img.blog.csdn.net/20161113120821987" alt="统计apk安装量"></p>
<p>获取IMEI</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">TelephonyManager telephonyManager = (TelephonyManager) ctx .getSystemService(Context.TELEPHONY_SERVICE);</div><div class="line">telephonyManager.getDeviceId();</div></pre></td></tr></table></figure>
<p>##<strong>3层加密</strong><br>只是加大了被破解的难度</p>
<ul>
<li>des加密–&gt;密码唯一化，复杂化(但是还是不安全)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">this.PASSWORD = &quot;com.sina.vdisk.security.password.d7af3082d815945ff47ae58647bd9436&quot; + IMEI + appKeyPair.key + appKeyPair.secret;</div></pre></td></tr></table></figure>
<ul>
<li>秘钥放到so库里面，通过jni调用-&gt;密码放到so库里面，这个时候，加到了获取秘钥的难度。(同样，反编译apk，可以拿到so库，然后可以调用本地方法获取到密码)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 本地方法 c实现</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title">getDataFromC</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">//从c中获取秘钥</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getKey</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="keyword">return</span> getInstance().getDataFromC();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#include &lt;jni.h&gt;</div><div class="line"></div><div class="line">jstring Java_com_example_level3encrypt_util_LanguageTransform_getDataFromC(JNIEnv* env,</div><div class="line">		jobject obj) &#123;</div><div class="line">	//JNIEnv* env  jni环境的上下文对象</div><div class="line">	//jobject obj  调用该方法的java对象</div><div class="line"></div><div class="line">	//返回一个java字符串,即秘钥</div><div class="line">	char* cstr = &quot;myKey0510YUY1234&quot;;</div><div class="line"></div><div class="line">	//将c字符串 转换成 java字符串</div><div class="line">	//	   jstring     (*NewStringUTF)(JNIEnv*, const char*);</div><div class="line">	jstring jstr = (**env).NewStringUTF(env, cstr);</div><div class="line">	return jstr;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>混淆(也是可以拿到，混淆的时候。我们的字符串是不会进行混淆的。只是混淆我们方法名，以及变量名)</li>
</ul>
<p>#第三方登录</p>
<ul>
<li>用qq号/微信号/微博号去登录自己的应用</li>
<li>核心：就是拿到我们access_token</li>
<li>实际开发第三方登录的协议：<a href="http://xxx?token=&gt;xxx&amp;type=x，token就是我们授权之后返回的access_token，type是为了区分不同登录渠道" target="_blank" rel="external">http://xxx?token=&gt;xxx&amp;type=x，token就是我们授权之后返回的access_token，type是为了区分不同登录渠道</a></li>
</ul>
<p>第三方登录协议</p>
<p><img src="http://img.blog.csdn.net/20161120021115253" alt="第三方登录协议"></p>
<p>#access_token是啥，干嘛用?</p>
<p>形象解释：申请调兵–&gt;皇帝同意–&gt;兵符–&gt;开始调兵<br>拿到用户在第三方平台的唯一的标识;<br>获取用户的nickname，头像，邮箱等其他信息;</p>
<p>##实际开发3大步<br>app做的事情，实际开发，我们能把我这里的几个步骤，就可以完成开发工作</p>
<p>1.发起授权请求，让用户授权（输入账号密码）<br>2.处理授权结果，拿到access_token<br>3.调用第三方登录协议(自己公司定义)，传递access_token到app的server，后续逻辑交给server </p>
<p>##server拿到access_token做了什么<br><img src="http://img.blog.csdn.net/20161113010631295" alt="这里写图片描述"></p>
<p>静默注册新用户或者返回已有用户用户信息</p>
<p>1.使用access_token拿到用户在第三方平台的唯一ID;<br>判断第三方平台的唯一ID是否存在我们的用户信息表中;<br>存在：(之前使用qq号登陆过自己的系统)返回当前用户的用户信息<br>不存在：(用户还没有使用过此qq登陆过我们的系统)</p>
<ol>
<li>调用相关的接口，拿到nickname，邮箱，头像(需要什么拿取什么);</li>
</ol>
<p>##qq登录_sso形式</p>
<p>sso(单点登录)方式：如果手机里面装了qq，那就是单点登录的形式，如果没有装qq，就是跳到webview这种老方式</p>
<p>返回参数</p>
<p><img src="http://img.blog.csdn.net/20161113101753778" alt="这里写图片描述"></p>
<p>#<strong>什么是开发平台</strong><br><img src="http://img.blog.csdn.net/20161112234000759" alt="这里写图片描述"></p>
<ul>
<li>开放平台（Open Platform） 在软件业和网络中，开放平台是指软件系统通过公开其应用程序编程接口（API）或函数（function)来使外部的程序可以增加该软件系统的功能或使用该软件系统的资源，而不需要更改该软件系统的源代码</li>
<li>开发平台的作用：提供功能，提供资源</li>
</ul>
<p>#<strong>OAuth</strong><br>OAuth是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用</p>
<p>##<strong>oauth产生背景</strong><br>传统互联网时代，各个网站和服务之间是封闭的，数据无法进行交互。随着互联网技术的迅猛发展、系统之间的相互协作日益增多，开放与共享数据的需求不断增加，互联网服务之间的整合已经成为必然趋势，一个通过自身开放平台来实现数据互通甚至用户共享的时代已经来临。把网站的服务封装成一系列计算机易识别的数据接口开放出去，供第三方开发者使用，这种行为就叫做Open API，提供开放API 的平台本身就被称为开放平台。</p>
<p>2007 年5 月份，Facebook 宣布改版，最早提出了开放平台的概念，正式从一个社交网站向一个社交应用平台转型。至此，开放平台发展迅速，成为互联网发展的趋势，也是一种革命性的发展模式</p>
<p>国内外已经有很多的公司开发了自己的开放平台，Facebook、Twitter、腾讯、新浪微博、人人网，它们用户规模大、技术实力强，为第三方提供了一整套自成体系、纷繁复杂的“开放API”。通过开放平台，网站不仅能提供对Web 网页的简单访问，还可以进行复杂的数据交互，允许第三方开发者利用其资源开发复杂的应用，既丰富自身网站应用，为用户提供更好的服务，逐步建立起一个服务完备的网络社会，也为第三方连接的网站带来更多的用户。开放平台迅速成为互联网发展的趋势。</p>
<p>开放平台的核心问题在于用户验证和授权。对于服务提供商来说，一般不会希望第三方直接使用用户名和密码来验证用户身份，除非双方具有很强的信任关系。OAuth 协议正是为了解决服务整合时“验证和授权”这一根本问题而产生的，具有同样认证功能的协议还有Openid。</p>
<p><img src="http://img.blog.csdn.net/20161112153348478" alt="oauth"></p>
<p>如果一个用户拥有两项服务：一项服务是图片在线存储服务A，另一个是图片在线打印服务B。如下图所示。由于服务A与服务B是由两家不同的服务提供商提供的，所以用户在这两家服务提供商的网站上各自注册了两个用户，假设这两个用户名各不相同，密码也各不相同。当用户要使用服务B打印存储在服务A上的图片时，用户该如何处理？</p>
<p>方法一：用户可能先将待打印的图片从服务A上下载下来并上传到服务B上打印，这种方式安全但处理比较繁琐，效率低下</p>
<p>方法二：用户将在服务A上注册的用户名与密码提供给服务B，服务B使用用户的帐号再去服务A处下载待打印的图片，这种方式效率是提高了，但是安全性大大降低了，服务B可以使用用户的用户名与密码去服务A上查看甚至篡改用户的资源。很多公司和个人都尝试解决这类问题，包括Google、Yahoo、Microsoft，这也促使OAUTH项目组的产生。OAuth是由Blaine Cook、Chris　　Messina、Larry Halff 及David Recordon共同发起的，目的在于为API访问授权提供一个开放的标准。</p>
<p>##<strong>什么是OAuth</strong><br><img src="http://img.blog.csdn.net/20161112234430113" alt="这里写图片描述"></p>
<p>OAuth是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。</p>
<p>OAuth允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth允许用户授权第三方网站访问他们存储在另外的服务提供者上的信息。</p>
<p>简单：不管是OAUTH服务提供者还是应用开发者，都很容易于理解与使用<br>安全：没有涉及到用户密钥等信息，更安全更灵活<br>开放：任何服务提供商都可以实现OAUTH，任何软 件开发商都可以使用OAUTH</p>
<p>##<strong>OAuth的核心工作流程</strong></p>
<p>OAuth 为客户端提供了一种代表资源拥有者访问受保护资源的方法。在客户端访问受保护资源之前，它必须先从资源拥有者获取授权（访问许可），然后用访问许可交换访问令牌（Access Token，包含许可的作用域、持续时间和其它属性等信息）。客户端通过向资源服务器出示访问令牌来访问受保护资源。</p>
<p>###<strong>OAuth1.0</strong><br>OAuth1.0主要流程是四步骤：</p>
<p>1、获取未授权的Request Token<br>2、请求用户授权Request Token<br>3、使用授权后的Request Token换取Access Token<br>4、使用 Access Token 访问或修改受保护资源。</p>
<p><img src="http://img.blog.csdn.net/20161112154430044" alt="这里写图片描述"></p>
<p>1.0的缺陷：</p>
<p>1、oauth1.0对手机客户端，移动设备等非server第三方的支持不好。是因为oauth1.0将多种流程合并成了一种，而事实证明，这种合并的流程体验性非常差。<br>2、oauth1.0的三步认证过程比较繁琐和复杂，对第三方开发者增加了极大的开发难度。<br>3、oauth1.0的加密需求过于复杂，第三方开发者使用oauth之前需要花费精力先实现oauth1.0的加密算法。<br>4、oauth1.0生成的access_token要求是永久有效的，这导致的问题是网站的安全性和破坏网站的架构。</p>
<p>###<strong>OAuth2.0</strong></p>
<p>oauth2.0针对1.0的各种问题提供了解决方法：</p>
<p>1、 oauth2.0提出了多种流程，各个客户端按照实际情况选择不同的流程来获取access_token。这样就解决了对移动设备等第三方的支持，也解决了拓展性的问题 </p>
<p>2 、oauth2.0删除了繁琐的加密算法。利用了https传输对认证的安全性进行了保证 </p>
<p>3、 oauth2.0的认证流程一般只有2步，对开发者来说，减轻了负担 </p>
<p>4 、oauth2.0提出了access_token的更新方案，获取access_token的同时也获取refresh_token， access_token是有过期时间的，refresh_token的过期时间较长，这样能随时使用refresh_token对access_token进行更新</p>
<p><img src="http://img.blog.csdn.net/20161112181823627" alt="这里写图片描述"></p>
<p><strong>oauth2.0授权流程</strong></p>
<ul>
<li>用户打开客户端以后，客户端要求用户给予授权。</li>
<li>用户同意给予客户端授权。</li>
<li>客户端使用上一步获得的授权，向认证服务器(比如qq登录，那就是腾讯)申请令牌。</li>
<li>认证服务器对客户端进行认证以后，确认无误，同意发放令牌。</li>
<li>客户端使用令牌，向资源服务器申请获取资源。</li>
<li>资源服务器确认令牌无误，同意向客户端开放资源</li>
</ul>
<p>授权流程图</p>
<p><img src="http://img.blog.csdn.net/20161112164809915" alt="授权流程图"></p>
<p>Oauth2.0根据授权方式和客户端状态的不同对应不一样的实现方式。</p>
<p>##<strong>Webserver方式</strong></p>
<p>适用场景：Web Server子态适用于有能力与终端用户的user-agent（通常是浏览器）交互并能够从授权服务器接收（通过重定向）请求（即有能力担当HTTP服务器的角色）的客户端。</p>
<p><img src="http://img.blog.csdn.net/20161112164920996" alt="这里写图片描述"></p>
<p>##<strong>userAgent方式</strong></p>
<p>适用场景：Web Server子态适用于有能力与终端用户的user-agent（通常是浏览器）交互并能够从授权服务器接收（通过重定向）请求（即有能力担当HTTP服务器的角色）的客户端 ，典型的例子是用诸如JavaScript语言编写并运行在浏览器的程序。这些客户端不能保存客户端私有证书，并且客户端的验证基于user-agent的同源策略。</p>
<p>说明：在其它子态中，客户端对于终端用户的授权和访问令牌使用分开的不同请求来完成，而与之不同的是，在user-agent子态中，客户端以HTTP重定向的方式在终端用户授权请求的结果中获取到访问令牌。客户端请求授权服务器将user-agent重定向到另一个web服务器或user-agent能访问到的本地资源，而且user-agent有能力从响应信息中提取出访问令牌并传给客户端。</p>
<p><img src="http://img.blog.csdn.net/20161112165003212" alt="这里写图片描述"></p>
<p>##原生程序方式</p>
<p>适用场景：原生程序方式适用于作为原生代码运行在终端用户计算机或移动设备上的客户端。这些客户端通常有能力与终端用户的user-agent交互（或嵌入user-agent）。</p>
<p>基于不同的需求和期望的终端用户体验，原生程序客户端可以有三种方式实现：</p>
<p>外部启用一个user-agent；<br>内嵌一个user-agent；<br>直接要求用户输入用户名和密码。</p>
<p>##优缺点：<br>外部浏览器可能会提高完成效率，因为终端用户可能已经登录过了而不需要重新进行身份验证。</p>
<p>嵌入的user-agent通常能提供更好的用户流程，因为它不必切换上下文并打开新窗口。</p>
<p>但嵌入的user-agent对安全提出了挑战，因为用户在一个无法辨别的窗口之中进行身份验证，而不像很多user-agent那样能提供可视化的保护。</p>
<p>第三种方式，实现起来最简单，但它将终端用户的密码直接交给了第三方客户端，而客户端不得不用明文存储密码，所以它要求客户端和认证服务方有很强的信任关系。</p>
<p><img src="http://img.blog.csdn.net/20161112165110041" alt="这里写图片描述"></p>
<p>##刷新令牌</p>
<p>OAuth2.0引入刷新令牌的方式重新获取访问令牌。访问令牌的生命周期通常比资源拥有者授予的要短一些。当分发一个访问令牌时，授权服务器可以同时传回一个刷新令牌，在当前访问令牌超时后，客户端可以用这个刷新令牌重新获取一个访问令牌。当请求新的访问令牌时，刷新令牌担当起访问许可的角色。使用刷新令牌，不再需要再次与资源拥有者交互，也不需要存储原始的访问许可来获得访问令牌和刷新令牌。</p>
<p>注：可以使用刷新令牌也可以直接使用客户端的私有证书</p>
<p><img src="http://img.blog.csdn.net/20161112165143839" alt="这里写图片描述"></p>
<p>##<strong>oauth2.0涉及的角色</strong></p>
<ul>
<li><strong>Third-party application</strong>：第三方应用程序，本文中又称”客户端”（client），即上一节例子中的”云冲印”</li>
<li><strong>HTTP service</strong>：HTTP服务提供商，本文中简称”服务提供商”，即上一节例子中的Google</li>
<li><strong>Resource Owner</strong>：资源所有者，本文中又称”用户”（user）。</li>
<li><strong>User Agent</strong>：用户代理，本文中就是指浏览器</li>
<li><strong>Authorization server</strong>：认证服务器，即服务提供商专门用来处理认证的服务器</li>
<li><strong>Resource server</strong>：资源服务器，即服务提供商存放用户生成的资源的服务器。它与认证服务器，可以是同一台服务器，也可以是不同的服务器</li>
</ul>
<p>说明：本文提出的OAuth使用方式是基于2.0协议，只对OAuth2.0 最核心的工作流程进行设计，即获取Access Token 的过程。</p>
<p><img src="http://img.blog.csdn.net/20161112155342968" alt="这里写图片描述"></p>
<p>#服务器端的数据存储方案</p>
<p>OAuth2.0 机制的核心工作流程，大部分信息，如APP 信息、用户和APP 之间的授权关系、Access Token等，需要永久性存储，存储在数据库中。一些不需要永久存储的信息，如临时授权码，只使用一次，而且，在很短的时间内就要使其失效，就没有必要存储在数据库之中，可存储在譬如memcached 等缓存系统中，即提高了系统的处理速度，又减少了数据库压力</p>
<p>#数据库表结构设计</p>
<p>客户端要先注册一个应用，获取该应用的APPID和APPSECRET，应用的详细信息存储在数据表中，如下图所示：</p>
<p><img src="http://img.blog.csdn.net/20161112154835609" alt="这里写图片描述"></p>
<p>用户授权信息表用来保存授权成功的访问令牌。</p>
<p><img src="http://img.blog.csdn.net/20161112154907806" alt="这里写图片描述"></p>
<p><img src="http://img.blog.csdn.net/20161112154933984" alt="这里写图片描述"></p>
<p>#<strong>OAuth和Openid的比较</strong></p>
<p>##<strong>Openid是什么</strong></p>
<p>OpenID 是一个以用户为中心的数字身份识别框架。</p>
<p>OpenID 的创建基于这样一个概念：我们可以通过 URI （又叫 URL 或网站地址）来认证一个网站的唯一身份，同理，我们也可以通过这种方式来作为用户的身份认证。由于URI 是整个网络世界的核心，它为基于URI的用户身份认证提供了广泛的、坚实的基础。</p>
<p>OAuth和Openid同为认证机制，但它们的侧重点不一样。</p>
<p>OAuth关注的授权，即：“用户能做什么” ；<br>而OpenID关注的是证明，即：“用户是谁”。</p>
<p>下面就分别来举例说明两者的功能。</p>
<p>###<strong>OpenID</strong></p>
<ul>
<li>用户希望访问其在example.com的账户</li>
<li>example.com 提示用户输入他/她/它的OpenID</li>
<li>用户给出了他的OpenID，比如说”<a href="http://user.myopenid.com”" target="_blank" rel="external">http://user.myopenid.com”</a></li>
<li>example.com 跳转到了用户的OpenID提供商“mypopenid.com”</li>
<li>用户在”myopenid.com”(OpenID provider)提示的界面上输入用户名密码登录</li>
<li>“myopenid.com” (OpenID provider) 问用户是否要登录到example.com</li>
<li>用户同意后，”myopenid.com” (OpenID provider) 跳转回example.com</li>
<li>example.com 允许用户访问其资源</li>
</ul>
<p>###<strong>OAuth</strong></p>
<ul>
<li>用户在使用example.com时希望从mycontacts.com导入他的联系人</li>
<li>example.com (在OAuth的黑话里面叫“Consumer”)把用户送往mycontacts.com (黑话是“Service Provider”)</li>
<li>用户在mycontacts.com 登录</li>
<li>mycontacts.com问用户是不是希望授权example.com访问他在mycontact.com的联系人</li>
<li>用户确定</li>
<li>mycontacts.com 把用户送回example.com</li>
<li>example.com 从mycontacts.com拿到联系人</li>
<li>example.com 告诉用户导入成功</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/images/wechat-reward-image.png" alt="JackChan WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/images/alipay-reward-image.jpg" alt="JackChan Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/oauth/" rel="tag"># oauth</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/01/android/VR全景图片与视频功能开发详解/" rel="next" title="VR全景图片与视频功能开发详解">
                <i class="fa fa-chevron-left"></i> VR全景图片与视频功能开发详解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/01/android/自定义控件：SlidingMenu，侧边栏，侧滑菜单/" rel="prev" title="自定义控件：SlidingMenu，侧边栏，侧滑菜单">
                自定义控件：SlidingMenu，侧边栏，侧滑菜单 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/ai.jpg"
               alt="JackChan" />
          <p class="site-author-name" itemprop="name">JackChan</p>
           
              <p class="site-description motion-element" itemprop="description">生活不止眼前的苟且，还有诗和远方！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">71</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JackChan1999" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.gitbook.com/@alleniverson" target="_blank" title="GitBook">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  GitBook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/1848214604?topnav=1&wvr=6&topsug=1&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/axi295309066" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/guolin_blog" title="郭霖" target="_blank">郭霖</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.csdn.net/lmj623565791" title="鸿洋" target="_blank">鸿洋</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://stormzhang.com/" title="张帅" target="_blank">张帅</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jikedaohang.com/" title="极客导航" target="_blank">极客导航</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-登录"><span class="nav-number">1.</span> <span class="nav-text">1. 登录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-javaweb中如何去维持登录状态"><span class="nav-number">1.1.</span> <span class="nav-text">1.1 javaweb中如何去维持登录状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-javaweb中哪些情况我们的session会过期"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 javaweb中哪些情况我们的session会过期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-手机端如何维持登录状态"><span class="nav-number">1.3.</span> <span class="nav-text">1.3 手机端如何维持登录状态</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JackChan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'http://yoursite.com/2017/05/01/android/Oauth机制/';
          this.page.identifier = '2017/05/01/android/Oauth机制/';
          this.page.title = 'Oauth机制';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      $('#local-search-input').focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

</body>
</html>
